<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: file.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: file.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {existsSync, readFileSync, writeFileSync, unlinkSync} = require('fs');
const {resolve} = require('path');
const ffmpeg = require('ffmpeg-static');
const {execSync} = require('child_process');
const nodewav = require('node-wav');

/**
 * Extracts the audio, as a wav file, from a media file (audio or video)
 * @param {string} input Path to the media file
 * @param {number} sampleRate The sample rate of the output wav file
 * @returns {string} Path to a temporary wav file
 */
function videoToAudioFile(input, sampleRate = 44100) {
	const tempfile = resolve(__dirname, 'temp', 'output.wav');
	if (existsSync(tempfile)) unlinkSync(tempfile);
	execSync(`${ffmpeg} -i "${input}" -ac 1 -ar ${sampleRate} -vn "${tempfile}"`, {stdio: 'pipe'});
	return tempfile;
}

/**
 * Reads a wav file into memory, and optionally deletes the file
 * @param {string} input Input Filename
 * @param {boolean} remove Delete the input file after loading
 * @returns {binary} Binary file
 */
function fileToWAV(input, remove = false) {
	const wav = readFileSync(input);
	if (remove) unlinkSync(input);
	return wav;
}

/**
 * Turns a binary wave file into an array
 * @param {binary} wav Wave file data
 * @returns {number[]} Array of numbers
 */
function wavToArray(wav) {
	return nodewav.decode(wav).channelData[0];
}

/**
 * Loads a wav file from disk and converts it to an array
 * @param {string} input Filename
 * @param {boolean} remove Delete the input file after loading
 * @returns {number[]} Wav file as an array
 */
function wavFileToArray(input, remove) {
	const wav = fileToWAV(input, remove);
	return wavToArray(wav);
}

/**
 * Loads the audio from a media file into a wav array
 * @param {string} filename The path to the media file
 * @param {number} sampleRate The sample rate of the output wav file
 * @returns {number[]} Wav file as an array
 */
function fileToArray(filename, sampleRate) {
	const input = videoToAudioFile(filename, sampleRate);
	return wavFileToArray(input, true);
}

/**
 *
 * @param {number[]} input Wav array
 * @param {number} sampleRate The sample rate of the output wav file
 * @returns {binary} Wav binary
 */
function arrayToWAV(input, sampleRate) {
	return nodewav.encode(input, {sampleRate, float: true, bitDepth: 32});
}

/**
 *
 * @param {binary} wav Wav binary
 * @param {string} output Filename
 * @returns {string} Output file path
 */
function wavToFile(wav, output) {
	output = resolve(output);
	if (!output.toLowerCase().endsWith('.wav')) output += '.wav';
	writeFileSync(output, wav);
	return output;
}

/**
 *
 * @param {number[]} input Wav array
 * @param {number} sampleRate The sample rate of the output wav file
 * @param {string} output Filename
 * @returns {string} Output file path
 */
function arrayToFile(input, sampleRate, output) {
	const wav = arrayToWAV(input, sampleRate);
	return wavToFile(wav, output);
}

module.exports = {
	load: fileToArray,
	save: arrayToFile,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#arrayToFile">arrayToFile</a></li><li><a href="global.html#arrayToWAV">arrayToWAV</a></li><li><a href="global.html#commandline">commandline</a></li><li><a href="global.html#detectPeaks">detectPeaks</a></li><li><a href="global.html#fft">fft</a></li><li><a href="global.html#fileToArray">fileToArray</a></li><li><a href="global.html#fileToWAV">fileToWAV</a></li><li><a href="global.html#getConfig">getConfig</a></li><li><a href="global.html#graph">graph</a></li><li><a href="global.html#limitPeaks">limitPeaks</a></li><li><a href="global.html#line">line</a></li><li><a href="global.html#lines">lines</a></li><li><a href="global.html#maxima">maxima</a></li><li><a href="global.html#pad">pad</a></li><li><a href="global.html#smoothArray">smoothArray</a></li><li><a href="global.html#threshold">threshold</a></li><li><a href="global.html#videoToAudioFile">videoToAudioFile</a></li><li><a href="global.html#wavFileToArray">wavFileToArray</a></li><li><a href="global.html#wavToArray">wavToArray</a></li><li><a href="global.html#wavToFile">wavToFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed May 05 2021 01:16:30 GMT+1200 (New Zealand Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
